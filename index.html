<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ROTA ¬∑ Painel √önico</title>
  <meta name="description" content="Painel √∫nico para unificar sistemas e documentos do Batalh√£o (GTA RP Pol√≠cia)" />

  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            sans: ['system-ui', 'ui-sans-serif', 'Inter', 'sans-serif'],
          },
          colors: {
            rota: {
              gold: '#fbbf24',
              dark: '#020617',
            },
          },
          boxShadow: {
            'glow-amber': '0 0 30px rgba(251, 191, 36, 0.25)',
          },
        },
      },
    }
  </script>

  <style>
    html, body, #root { height: 100%; }
    body { background: #020617; }
  </style>
</head>
<body class="dark antialiased">
  <div id="root"></div>

  <!-- React + Babel -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useMemo, useState, useEffect } = React;

    // ----------------- URLs E CONFIG -----------------
    const RAW_LINKS = {
      // Sistemas
      ponto: "https://gabrielsaleh1.github.io/Ponto-Online",
      rso: "https://gabrielsaleh1.github.io/RSO-Online",

      // Hierarquia travada em leitura (par√¢metro + sandbox)
      hierarquia: "https://gabrielsaleh1.github.io/Hierarquia?view=1",

      // Documentos do Batalh√£o
      fardamentos: "docs.google.com/spreadsheets/u/1/d/15q-JK8zUxIMMAAp_ssNFRrNsddTfGIJHVP241RUw3J4/edit?usp=sharing",
      doutrinas: "https://docs.google.com/document/d/1LPXXQl9Ux7o3iEy8zCpRePdtH_zCRyUnKS1Bkj_bLjE/edit?usp=sharing",
      secoes: "https://docs.google.com/spreadsheets/d/1Rw6o7O1rAjVC4XCDFwe6L0vInKSQsBvYZsWm6Rb1pfE/edit?gid=0#gid=0",
      crimes: "https://docs.google.com/document/d/1iGnC80f9COCirKVGHYm5Nr9xSr6hodYHCDl3IAXZvoY/edit?tab=t.0",
      companias: "https://docs.google.com/spreadsheets/d/1tNkMNbSzPn1qSgkKUlZQzOzJo6AwBd-STesfG_Sav6w/edit?usp=sharing",
    };

    // Converte links do Google Docs/Sheets para /preview (melhor para iframe)
    function toEmbedUrl(url) {
      if (!url) return url;
      if (!/^https?:\/\//i.test(url)) url = "https://" + url;
      try {
        const u = new URL(url);
        if (u.hostname !== "docs.google.com") return url;
        const parts = u.pathname.split("/").filter(Boolean);
        const type = parts[0]; // "document" | "spreadsheets" | ...
        const idIndex = parts.findIndex(p => p === "d");
        const fileId = idIndex >= 0 ? parts[idIndex + 1] : null;
        if (fileId) {
          const frag = u.hash || "";
          return `https://docs.google.com/${type}/d/${fileId}/preview${frag}`;
        }
      } catch(e) {}
      return url;
    }

    // Itens da interface
    const CONFIG = {
      brand: { name: "ROTA ¬∑ Painel √önico", badge: "Batalh√£o ROTA ¬∑ GTA RP" },
      version: "v1.0 ¬∑ Painel Unificado",
      sections: [
        {
          label: "Sistemas Operacionais",
          items: [
            {
              id: "ponto",
              name: "Bate-Ponto",
              url: RAW_LINKS.ponto,
              icon: "‚è±Ô∏è",
              desc: "Registro de in√≠cio e fim de servi√ßo dos militares.",
              tag: "PRINCIPAL",
              sandbox: null,
            },
            {
              id: "rso",
              name: "RSO Online",
              url: RAW_LINKS.rso,
              icon: "üìã",
              desc: "Registro de Servi√ßos Operacionais.",
              tag: "OCORR√äNCIAS",
              sandbox: null,
            },
          ],
        },
        {
          label: "Documentos do Batalh√£o",
          items: [
            {
              id: "hierarquia",
              name: "Hierarquia do Batalh√£o",
              url: RAW_LINKS.hierarquia,
              icon: "üèõÔ∏è",
              desc: "Estrutura hier√°rquica completa da unidade.",
              tag: "CONSULTA",
              sandbox: "allow-scripts allow-same-origin allow-downloads",
            },
            {
              id: "fardamentos",
              name: "Fardamentos do Batalh√£o",
              url: RAW_LINKS.fardamentos,
              icon: "üéΩ",
              desc: "Controle e padr√£o dos fardamentos.",
              tag: "LOG√çSTICA",
              sandbox: null,
            },
            {
              id: "doutrinas",
              name: "Doutrinas e Regimento Interno",
              url: RAW_LINKS.doutrinas,
              icon: "üìú",
              desc: "Normas, procedimentos e regras do batalh√£o.",
              tag: "NORMAS",
              sandbox: null,
            },
            {
              id: "secoes",
              name: "Se√ß√µes Internas do Batalh√£o",
              url: RAW_LINKS.secoes,
              icon: "üóÇÔ∏è",
              desc: "Organiza√ß√£o das se√ß√µes internas.",
              tag: "ADMINISTRATIVO",
              sandbox: null,
            },
            {
              id: "crimes",
              name: "Crimes Militares",
              url: RAW_LINKS.crimes,
              icon: "‚öñÔ∏è",
              desc: "Tabela de crimes e enquadramentos.",
              tag: "LEGISLA√á√ÉO",
              sandbox: null,
            },
            {
              id: "companias",
              name: "Companias",
              url: RAW_LINKS.companias,
              icon: "‚ö°",
              desc: "Registro de oficiais de Companias.",
              tag: "LOGISTICA",
              sandbox: null,
              },
          ],
        },
      ],
    };

    // ----------------- COMPONENTES -----------------
    function Sidebar({ sections, activeId, onSelect }) {
      return (
        <aside className="w-80 shrink-0 border-r border-white/10 bg-slate-950/80 backdrop-blur-xl rounded-3xl p-3 flex flex-col shadow-xl shadow-black/40">
          {/* Cabe√ßalho da marca */}
          <div className="px-3 py-3 mb-2 rounded-2xl bg-gradient-to-r from-amber-500/20 via-amber-400/10 to-transparent border border-amber-400/40 shadow-glow-amber">
            <div className="flex items-center gap-3">
              <div className="h-10 w-10 rounded-2xl grid place-items-center bg-black/60 border border-amber-400 font-black text-lg tracking-tight">
                R
              </div>
              <div className="flex-1">
                <div className="text-[10px] uppercase tracking-[0.2em] text-amber-200/80">
                  {CONFIG.brand.badge}
                </div>
                <div className="font-extrabold text-sm leading-tight">
                  {CONFIG.brand.name}
                </div>
              </div>
            </div>
            <div className="mt-2 flex items-center justify-between text-[11px] text-slate-300/80">
              <span className="inline-flex items-center gap-1">
                <span className="inline-flex h-1.5 w-1.5 rounded-full bg-emerald-400 animate-pulse" />
                <span>Central operacional online</span>
              </span>
              <span className="text-slate-400">{CONFIG.version}</span>
            </div>
          </div>

          {/* Navega√ß√£o */}
          <nav className="mt-1 flex-1 overflow-y-auto pr-1 space-y-4">
            {sections.map((sec) => (
              <div key={sec.label}>
                <div className="px-3 mb-1 text-[10px] font-semibold uppercase tracking-[0.25em] text-slate-400">
                  {sec.label}
                </div>
                <div className="space-y-1.5">
                  {sec.items.map((it) => {
                    const isActive = activeId === it.id;
                    return (
                      <button
                        key={it.id}
                        onClick={() => onSelect(it.id)}
                        className={[
                          "group w-full text-left px-3.5 py-2.5 rounded-2xl border flex items-start gap-3 transition-all duration-200",
                          "hover:-translate-y-[1px]",
                          isActive
                            ? "border-amber-400/80 bg-gradient-to-r from-amber-500/20 via-amber-500/10 to-transparent shadow-glow-amber"
                            : "border-white/10 bg-slate-900/60 hover:bg-slate-800/80 hover:border-amber-400/40"
                        ].join(" ")}
                      >
                        <div className="mt-0.5 text-lg">
                          <span className="drop-shadow">{it.icon}</span>
                        </div>
                        <div className="flex-1 min-w-0">
                          <div className="flex items-center gap-2">
                            <div className="font-semibold text-sm truncate">
                              {it.name}
                            </div>
                            <span className={[
                              "inline-flex items-center rounded-full px-2 py-[2px] text-[10px] border",
                              isActive
                                ? "border-amber-300/60 bg-amber-500/15 text-amber-100"
                                : "border-slate-600 bg-slate-900/80 text-slate-200/80 group-hover:border-amber-300/60 group-hover:text-amber-100"
                            ].join(" ")}
                            >
                              {it.tag}
                            </span>
                          </div>
                          <p className="mt-0.5 text-[11px] text-slate-400 line-clamp-2">
                            {it.desc}
                          </p>
                        </div>
                      </button>
                    );
                  })}
                </div>
              </div>
            ))}
          </nav>

          {/* Rodap√© */}
          <div className="mt-3 pt-2 border-t border-white/5 text-[11px] text-slate-500 flex items-center justify-between px-2">
            <span>
              Desenvolvido para <span className="font-semibold text-slate-300">Batalh√£o ROTA</span>
            </span>
          </div>
        </aside>
      );
    }

    function Topbar({ title }) {
      return (
        <header className="sticky top-0 z-20 mb-4">
          <div className="rounded-3xl border border-white/10 bg-gradient-to-r from-slate-950/90 via-slate-900/80 to-slate-950/90 backdrop-blur-xl px-5 py-3 flex items-center justify-between shadow-xl shadow-black/40">
            <div>
              <div className="text-[11px] uppercase tracking-[0.3em] text-slate-400">
                Painel de Controle
              </div>
              <div className="flex items-center gap-2 mt-1">
                <h1 className="font-bold text-lg tracking-tight">
                  {title}
                </h1>
              </div>
            </div>
            <div className="flex items-center gap-3 text-xs text-slate-300">
              <div className="hidden sm:flex items-center gap-1 px-2.5 py-1.5 rounded-2xl border border-white/10 bg-slate-900/70">
                <span className="inline-flex h-1.5 w-1.5 rounded-full bg-emerald-400 mr-1" />
                <span>Servidor ativo</span>
              </div>
              <div className="flex items-center gap-1 px-2.5 py-1.5 rounded-2xl border border-white/10 bg-slate-900/70">
                <kbd className="px-1.5 py-0.5 rounded border border-white/15 text-[10px] bg-black/60">
                  CTRL
                </kbd>
                <span>+</span>
                <kbd className="px-1.5 py-0.5 rounded border border-white/15 text-[10px] bg-black/60">
                  D
                </kbd>
                <span className="hidden sm:inline">¬∑ Favoritar no navegador</span>
              </div>
            </div>
          </div>
        </header>
      );
    }

    function Frame({ item }) {
      const [loaded, setLoaded] = useState(false);
      const [blocked, setBlocked] = useState(false);

      const resolvedUrl = useMemo(() => toEmbedUrl(item?.url || ""), [item]);

      useEffect(() => {
        setLoaded(false);
        setBlocked(false);
      }, [resolvedUrl]);

      useEffect(() => {
        const t = setTimeout(() => { if (!loaded) setBlocked(true); }, 5000);
        return () => clearTimeout(t);
      }, [loaded, resolvedUrl]);

      if (!item) {
        return (
          <div className="h-[calc(100vh-160px)] rounded-3xl border border-dashed border-white/15 bg-slate-950/80 grid place-items-center text-slate-400">
            Selecione um sistema ou documento na lateral esquerda.
          </div>
        );
      }

      return (
        <div className="space-y-3">
          {/* Barra de info do item selecionado */}
          <div className="rounded-2xl border border-white/10 bg-slate-950/80 backdrop-blur-xl px-4 py-3 flex flex-wrap items-center justify-between gap-3 shadow-lg shadow-black/40">
            <div className="flex items-start gap-3">
              <div className="h-10 w-10 rounded-2xl grid place-items-center bg-slate-900 border border-amber-400/40 text-lg">
                {item.icon}
              </div>
              <div>
                <div className="flex items-center gap-2">
                  <h2 className="font-semibold text-sm">{item.name}</h2>
                  <span className="px2 py-0.5 text-[10px] rounded-full border border-slate-600 text-slate-300 bg-slate-900/80">
                    {item.tag}
                  </span>
                </div>
                <p className="text-[11px] text-slate-400 mt-0.5 max-w-xl">
                  {item.desc}
                </p>
              </div>
            </div>

            <div className="flex items-center gap-2">
              <button
                onClick={() => window.open(item.url, "_blank", "noopener,noreferrer")}
                className="inline-flex items-center gap-1.5 rounded-full border border-amber-400/70 bg-gradient-to-r from-amber-500/80 to-amber-400 text-slate-900 text-xs font-semibold px-3 py-1.5 shadow-glow-amber hover:brightness-110 transition"
              >
                <span>üîó</span>
                <span>Abrir em nova aba</span>
              </button>
            </div>
          </div>

          {/* √Årea do iframe */}
          <div className="relative h-[calc(100vh-220px)] rounded-3xl border border-white/10 bg-slate-950/90 overflow-hidden shadow-2xl shadow-black/50">
            {/* Estado de carregamento */}
            {!loaded && (
              <div className="absolute inset-0 grid place-items-center z-10">
                <div className="px-4 py-3 rounded-2xl border border-white/10 bg-slate-900/90 text-sm text-slate-300 flex flex-col items-center gap-2">
                  <div className="flex items-center gap-2 text-xs text-slate-400">
                    <span className="h-2 w-2 rounded-full bg-amber-400 animate-ping" />
                    <span>Carregando conte√∫do...</span>
                  </div>
                  <div className="flex gap-1 text-[10px] text-slate-500">
                    <span>Dica:</span>
                    <span>se demorar muito, use o bot√£o ‚ÄúAbrir em nova aba‚Äù.</span>
                  </div>
                </div>
              </div>
            )}

            {/* Aviso de bloqueio */}
            {blocked && (
              <div className="absolute top-3 right-3 z-20 px-3 py-2 rounded-2xl border border-amber-400/40 bg-amber-500/15 text-amber-100 text-[11px] max-w-xs">
                Este documento pode n√£o permitir incorpora√ß√£o. Verifique as permiss√µes no Google ou use o bot√£o
                <span className="font-semibold"> ‚ÄúAbrir em nova aba‚Äù</span>.
              </div>
            )}

            <iframe
              title={item.name}
              src={resolvedUrl}
              className="w-full h-full border-0"
              referrerPolicy="no-referrer"
              sandbox={item.sandbox || null}
              onLoad={() => setLoaded(true)}
            ></iframe>
          </div>
        </div>
      );
    }

    function App() {
      const flatItems = useMemo(() => CONFIG.sections.flatMap(s => s.items), []);
      const [active, setActive] = useState(() => {
        // L√™ √∫ltimo item usado, se existir
        const stored = typeof window !== "undefined" ? window.localStorage.getItem("rota-active-item") : null;
        return stored || (flatItems[0]?.id || "");
      });

      const activeItem = useMemo(
        () => flatItems.find(x => x.id === active),
        [active, flatItems]
      );

      useEffect(() => {
        if (active) {
          window.localStorage.setItem("rota-active-item", active);
        }
      }, [active]);

      return (
        <div className="min-h-screen w-full bg-gradient-to-br from-slate-950 via-slate-900 to-slate-950 text-slate-100">
          <div className="absolute inset-0 -z-10 pointer-events-none opacity-60">
            <div className="absolute -top-40 -right-40 h-80 w-80 rounded-full bg-amber-500/10 blur-3xl" />
            <div className="absolute bottom-0 left-10 h-64 w-64 rounded-full bg-sky-500/5 blur-3xl" />
          </div>

          <div className="max-w-7xl mx-auto px-3 sm:px-4 py-4 sm:py-6">
            <Topbar title={activeItem?.name || CONFIG.brand.name} />
            <div className="flex gap-4 sm:gap-5 items-stretch">
              <Sidebar
                sections={CONFIG.sections}
                activeId={active}
                onSelect={setActive}
              />
              <main className="flex-1">
                <Frame item={activeItem} />
              </main>
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
