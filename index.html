<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ROTA ¬∑ Painel √önico</title>
  <meta name="description" content="Painel √∫nico para unificar sistemas e documentos do Batalh√£o (GTA RP Pol√≠cia)" />
  <!-- Tailwind CSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { darkMode: 'class', theme: { extend: {} } }
  </script>
  <style>
    html, body, #root { height: 100%; }
    body { background: #020617; } /* slate-950 */
  </style>
</head>
<body class="dark">
  <div id="root"></div>

  <!-- React + Babel -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <script type="text/babel">
    const { useMemo, useState, useEffect } = React;

    // ----------------- URLs E CONFIG -----------------
    const RAW_LINKS = {
      // Sistemas
      ponto: "https://gabrielsaleh1.github.io/Ponto-Online",
      rso: "https://gabrielsaleh1.github.io/RSO-Online",

      // Hierarquia travada em leitura (par√¢metro + sandbox)
      hierarquia: "https://gabrielsaleh1.github.io/Hierarquia?view=1",

      // Documentos do Batalh√£o
      fardamentos: "docs.google.com/spreadsheets/u/1/d/15q-JK8zUxIMMAAp_ssNFRrNsddTfGIJHVP241RUw3J4/edit?usp=sharing",
      doutrinas: "https://docs.google.com/document/d/1LwrV0gPkA0QCRinGGXtQF0bsaWri-rQZOdPiVmCPVus/edit?usp=sharing",
      secoes: "https://docs.google.com/spreadsheets/d/1Rw6o7O1rAjVC4XCDFwe6L0vInKSQsBvYZsWm6Rb1pfE/edit?gid=0#gid=0",
      crimes: "https://docs.google.com/document/d/1iGnC80f9COCirKVGHYm5Nr9xSr6hodYHCDl3IAXZvoY/edit?tab=t.0",
    };

    // Converte links do Google Docs/Sheets para /preview (melhor para iframe)
    function toEmbedUrl(url) {
      if (!url) return url;
      if (!/^https?:\/\//i.test(url)) url = "https://" + url;
      try {
        const u = new URL(url);
        if (u.hostname !== "docs.google.com") return url;
        const parts = u.pathname.split("/").filter(Boolean);
        const type = parts[0]; // "document" | "spreadsheets" | ...
        const idIndex = parts.findIndex(p => p === "d");
        const fileId = idIndex >= 0 ? parts[idIndex + 1] : null;
        if (fileId) {
          const frag = u.hash || "";
          return `https://docs.google.com/${type}/d/${fileId}/preview${frag}`;
        }
      } catch(e) {}
      return url;
    }

    // Itens da interface
    const CONFIG = {
      brand: { name: "ROTA ¬∑ Painel √önico", badge: "GTA RP" },
      sections: [
        {
          label: "Sistemas",
          items: [
            { id: "ponto", name: "Bate-Ponto", url: RAW_LINKS.ponto, icon: "‚è±Ô∏è", sandbox: null },
            { id: "rso", name: "RSO Online", url: RAW_LINKS.rso, icon: "üìã", sandbox: null },
          ],
        },
        {
          label: "Documentos do Batalh√£o",
          items: [
            // Hierarquia com sandbox de leitura
            { id: "hierarquia", name: "Hierarquia do Batalh√£o", url: RAW_LINKS.hierarquia, icon: "üèõÔ∏è",
              sandbox: "allow-scripts allow-same-origin allow-downloads" },
            { id: "fardamentos", name: "Fardamentos do Batalh√£o", url: RAW_LINKS.fardamentos, icon: "üéΩ", sandbox: null },
            { id: "doutrinas", name: "Doutrinas e Regimento Interno", url: RAW_LINKS.doutrinas, icon: "üìú", sandbox: null },
            { id: "secoes", name: "Se√ß√µes Internas do Batalh√£o", url: RAW_LINKS.secoes, icon: "üóÇÔ∏è", sandbox: null },
            { id: "crimes", name: "Crimes Militares", url: RAW_LINKS.crimes, icon: "‚öñÔ∏è", sandbox: null },
          ],
        },
      ],
    };

    // ----------------- COMPONENTES -----------------
    function Sidebar({ sections, activeId, onSelect }) {
      return (
        <aside className="w-80 shrink-0 border-r border-white/10 bg-slate-900/40 backdrop-blur">
          <div className="p-4 border-b border-white/10">
            <div className="text-xs uppercase tracking-widest text-slate-400">{CONFIG.brand.badge}</div>
            <div className="font-black text-lg">{CONFIG.brand.name}</div>
          </div>

          <nav className="p-2">
            {sections.map((sec) => (
              <div key={sec.label} className="mb-3">
                <div className="px-2 py-1 text-xs uppercase tracking-widest text-slate-400">{sec.label}</div>
                <div className="mt-1 space-y-1">
                  {sec.items.map((it) => (
                    <button
                      key={it.id}
                      onClick={() => onSelect(it.id)}
                      className={`w-full text-left px-3 py-2 rounded-xl transition border flex items-center gap-2 ${
                        activeId === it.id
                          ? "bg-amber-500 text-slate-900 border-amber-400"
                          : "border-white/10 hover:bg-white/5"
                      }`}
                    >
                      <span className="text-base">{it.icon}</span>
                      <div>
                        <div className="font-semibold text-sm">{it.name}</div>
                      </div>
                    </button>
                  ))}
                </div>
              </div>
            ))}
          </nav>

          <div className="p-3 mt-auto text-[11px] text-slate-500">
            <div>v0.6 ‚Äî Painel Unificado</div>
          </div>
        </aside>
      );
    }

    function Topbar({ title }) {
      return (
        <header className="sticky top-0 z-10 bg-slate-950/70 backdrop-blur border-b border-white/10">
          <div className="max-w-7xl mx-auto px-4 py-3 flex items-center gap-3">
            <div className="h-9 w-9 rounded-lg grid place-items-center font-black border border-amber-500/40 bg-slate-900/60">R</div>
            <div className="font-bold">{title}</div>
          </div>
        </header>
      );
    }

    function Frame({ url, sandbox }) {
      const [loaded, setLoaded] = useState(false);
      const [blocked, setBlocked] = useState(false);

      // Converte /preview para docs; mant√©m outras URLs
      const resolvedUrl = useMemo(() => toEmbedUrl(url), [url]);

      useEffect(() => {
        setLoaded(false);
        setBlocked(false);
      }, [resolvedUrl]);

      useEffect(() => {
        const t = setTimeout(() => { if (!loaded) setBlocked(true); }, 5000);
        return () => clearTimeout(t);
      }, [loaded, resolvedUrl]);

      return (
        <div className="relative h-[calc(100vh-120px)]">
          {!loaded && (
            <div className="absolute inset-0 grid place-items-center text-slate-400">
              <div className="px-3 py-2 rounded-xl border border-white/10 bg-slate-900/60 text-sm">
                Carregando conte√∫do‚Ä¶
              </div>
            </div>
          )}
          {blocked && (
            <div className="absolute top-3 right-3 px-3 py-2 rounded-xl border border-amber-400/30 bg-amber-500/10 text-amber-200 text-xs">
              Caso o documento n√£o permita incorpora√ß√£o, verifique permiss√µes do Google.
            </div>
          )}
          <iframe
            title="app-frame"
            src={resolvedUrl}
            className="w-full h-full rounded-xl border border-white/10 bg-slate-950"
            referrerPolicy="no-referrer"
            sandbox={sandbox || null}
            onLoad={() => setLoaded(true)}
          ></iframe>
        </div>
      );
    }

    function App() {
      const flatItems = useMemo(() => CONFIG.sections.flatMap(s => s.items), []);
      const [active, setActive] = useState(flatItems[0]?.id || "");
      const activeItem = useMemo(() => flatItems.find(x => x.id === active), [active, flatItems]);

      return (
        <div className="min-h-screen bg-slate-950 text-slate-100">
          <Topbar title={activeItem?.name || CONFIG.brand.name} />
          <div className="max-w-7xl mx-auto p-4 flex gap-4">
            <Sidebar
              sections={CONFIG.sections}
              activeId={active}
              onSelect={setActive}
            />
            <main className="flex-1">
              <Frame url={activeItem?.url || ""} sandbox={activeItem?.sandbox || null} />
            </main>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
